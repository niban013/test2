window.DtI18n = (function () {

    function applyLanguage(options = {}) {
        return {
            ...options,
            language: {
                ...(options.language || {}),
                lengthMenu: parent.i18n.t("dt.lengthMenu"),
                emptyTable: parent.i18n.t("dt.emptyTable"),
                zeroRecords: parent.i18n.t("dt.zeroRecords"),
                processing: parent.i18n.t("dt.processing"),
                loadingRecords: parent.i18n.t("dt.loadingRecords"),
                paginate: {
                    first: parent.i18n.t("dt.paginate.first"),
                    previous: parent.i18n.t("dt.paginate.prev"),
                    next: parent.i18n.t("dt.paginate.next"),
                    last: parent.i18n.t("dt.paginate.last")
                },
                aria: {
                    sortAscending: parent.i18n.t("dt.aria.sortAscending"),
                    sortDescending: parent.i18n.t("dt.aria.sortDescending")
                }
            },
            infoCallback: function (settings, start, end, max, total) {
                if (total === 0) {
                    return parent.i18n.t("dt.infoEmpty");
                }
                return parent.i18n.t("dt.info", [start, end, total]);
            }
        };
    }
    function patchPaginateText(table) {
        const container = table.table().container();
        if (!container) return;

        const buttons = container.querySelectorAll('button.dt-paging-button');

        buttons.forEach(btn => {
            const idx = btn.getAttribute('data-dt-idx');
            if (!idx) return;

            switch (idx) {
                case 'first':
                    btn.innerHTML = parent.i18n.t('dt.paginate.first');
                    break;
                case 'previous':
                    btn.innerHTML = parent.i18n.t('dt.paginate.prev');
                    break;
                case 'next':
                    btn.innerHTML = parent.i18n.t('dt.paginate.next');
                    break;
                case 'last':
                    btn.innerHTML = parent.i18n.t('dt.paginate.last');
                    break;
            }
        });
    }
    function patchEmpty(table) {
        const container = table.table().container();
        const cell = container.querySelector('td.dt-empty');
        if (!cell) return;

        const isFiltered = table.search && table.search();
        cell.innerHTML = isFiltered
            ? parent.i18n.t('dt.zeroRecords')
            : parent.i18n.t('dt.emptyTable');
    }

    function patchLengthMenu(table) {
        const container = table.table().container();
        const label = container.querySelector('.dt-length label');
        if (!label) return;

        const select = label.querySelector('select');
        if (!select) return;

        label.innerHTML = '';
        const text = parent.i18n.t('dt.lengthMenu').replace('_MENU_', '');
        label.append(text, select);
    }

    function bindI18n(table) {
        if (!parent.i18n || typeof parent.i18n.onChange !== 'function') return;

        parent.i18n.onChange(() => {
            patchPaginateText(table);
            patchLengthMenu(table);
            patchEmpty(table);
            table.draw(false); // æ›´æ–° infoCallback
        });
    }

    function create(selector, options) {
        const tableEl = document.querySelector(selector);

        const table = new DataTable(
            tableEl,
            applyLanguage(options)
        );

        tableEl._dataTableInstance = table;
        tableEl.setAttribute('data-dt-schema', '');

        patchLengthMenu(table);
        patchEmpty(table);

        bindI18n(table);

        setTimeout(() => table.columns.adjust(), 100);

        table.on('draw', () => {
            patchEmpty(table);
        });

        return table;
    }

    return { create };

})();


{
  "pageTitleDefault": "ESGå„€è¡¨æ¿",
  "greeting": "ä½ å¥½, ä½¿ç”¨è€…",
  "logout": "ç™»å‡º",
  "downloading": "é–‹å§‹æ¨¡æ“¬ä¸‹è¼‰",
  "menu": "é¸å–®",
  "welcome": "ä½ å¥½ï¼Œ{0}ï¼æ­¡è¿å›ä¾†ï¼",
  "analyze": "åˆ†æ",
  "name cc": "å§“å",
  "age": "å¹´é½¡",
  "greet": "{0}ï¼Œ{1}ï¼",
  "footerInfo": "&copy; 2025 ç¶ è‰²æ°¸çºŒè‚¡ä»½æœ‰é™å…¬å¸ - ESGå ±å‘Šå¹³å°<br>è¯çµ¡ä¿¡ç®±ï¼šinfo@esgcompany.com",
  "menuItems": {
    "sustain": "æ°¸çºŒå ±å‘Š",
    "analysis": "ç¢³æ’åˆ†æ",
    "sub1": "ç¯„ç–‡ä¸€æ’æ”¾",
    "sub2": "ç¯„ç–‡äºŒæ’æ”¾",
    "z22": "ç’°å¢ƒå„€è¡¨"
  },
  "dt": {
    "info": "é¡¯ç¤ºç¬¬ {0} ç­†åˆ°ç¬¬ {1} ç­†ï¼Œå…± {2} ç­†",
    "infoEmpty": "æ²’æœ‰è³‡æ–™",
    "lengthMenu": "æ¯é é¡¯ç¤º _MENU_ ç­†",
    "emptyTable": "ç›®å‰æ²’æœ‰è³‡æ–™",
    "zeroRecords": "æŸ¥ç„¡ç¬¦åˆæ¢ä»¶çš„è³‡æ–™",
    "processing": "è³‡æ–™è™•ç†ä¸­...",
    "loadingRecords": "è¼‰å…¥è³‡æ–™ä¸­...",
    "paginate": {
      "first": "ç¬¬ä¸€é ",
      "prev": "ä¸Šä¸€é ",
      "next": "ä¸‹ä¸€é ",
      "last": "æœ€å¾Œä¸€é "
    },
    "aria": {
      "sortAscending": ": å‡åºæ’åˆ—",
      "sortDescending": ": é™åºæ’åˆ—"
    }
  }
}


{
  "pageTitleDefault": "ESG Dashboard",
  "greeting": "Hello, User",
  "logout": "Logout",
  "downloading": "Start Download",
  "menu": "Menu",
  "analyze": "analyze",
  "welcome": "ä½ å¥½ï¼Œ{0}ï¼æ­¡è¿å›ä¾†ï¼",
  "greet": "{0}ï¼Œ{1}ï¼",
  "name cc": "Name",
  "age": "Age",
  "footerInfo": "&copy; 2025 Green Sustainability Corp - ESG Report Platform<br>Email: info@esgcompany.com",
  "menuItems": {
    "sustain": "Sustainability Report",
    "analysis": "Carbon Analysis",
    "sub1": "Scope 1 Emission",
    "sub2": "Scope 2 Emission",
    "z22": "Dashboard"
  },
  "dt": {
    "info": "Showing {0} to {1} of {2} entries",
    "infoEmpty": "No data available",
    "lengthMenu": "Show _MENU_ entries per page",
    "emptyTable": "No data available in table",
    "zeroRecords": "No matching records found",
    "processing": "Processing...",
    "loadingRecords": "Loading data...",
    "paginate": {
      "first": "First",
      "prev": "Previous",
      "next": "Next",
      "last": "Last"
    },
    "aria": {
      "sortAscending": ": activate to sort column ascending",
      "sortDescending": ": activate to sort column descending"
    }
  }
}

{
  "pageTitleDefault": "ESG ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰",
  "greeting": "ã“ã‚“ã«ã¡ã¯, ãƒ¦ãƒ¼ã‚¶ãƒ¼",
  "logout": "ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ",
  "downloading": "ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰é–‹å§‹",
  "menu": "ãƒ¡ãƒ‹ãƒ¥ãƒ¼",
  "welcome": "ã“ã‚“ã«ã¡ã¯ï¼Œ{0}ï¼æ­¡è¿å›ä¾†ï¼",
  "greet": "{0}ï¼Œ{1}ï¼",
  "name cc": "å§“åja",
  "age": "å¹´é½¡ja",
  "footerInfo": "&copy; 2025 ã‚°ãƒªãƒ¼ãƒ³ã‚µã‚¹ãƒ†ãƒŠãƒ“ãƒªãƒ†ã‚£æ ªå¼ä¼šç¤¾ - ESGãƒ¬ãƒãƒ¼ãƒˆãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ <br>ãƒ¡ãƒ¼ãƒ«: info@esgcompany.com",
  "menuItems": {
    "sustain": "ã‚µã‚¹ãƒ†ãƒŠãƒ“ãƒªãƒ†ã‚£å ±å‘Š",
    "analysis": "ç‚­ç´ åˆ†æ",
    "sub1": "ã‚¹ã‚³ãƒ¼ãƒ—1æ’å‡º",
    "sub2": "ã‚¹ã‚³ãƒ¼ãƒ—2æ’å‡º",
    "z22": "ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰"
  },
  "dt": {
    "info": "{0} ä»¶ç›®ã‹ã‚‰ {1} ä»¶ç›®ã¾ã§ã‚’è¡¨ç¤ºã€åˆè¨ˆ {2} ä»¶",
    "infoEmpty": "ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“",
    "lengthMenu": "1ãƒšãƒ¼ã‚¸ã« _MENU_ ä»¶è¡¨ç¤º",
    "emptyTable": "ç¾åœ¨ã€ãƒ‡ãƒ¼ã‚¿ã¯ã‚ã‚Šã¾ã›ã‚“",
    "zeroRecords": "è©²å½“ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“",
    "processing": "å‡¦ç†ä¸­...",
    "loadingRecords": "ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...",
    "paginate": {
      "first": "æœ€åˆã®ãƒšãƒ¼ã‚¸",
      "prev": "å‰ã¸",
      "next": "æ¬¡ã¸",
      "last": "æœ€å¾Œã®ãƒšãƒ¼ã‚¸"
    },
    "aria": {
      "sortAscending": ": æ˜‡é †ã«ä¸¦ã¹æ›¿ãˆ",
      "sortDescending": ": é™é †ã«ä¸¦ã¹æ›¿ãˆ"
    }
  }
}


// ğŸŒ i18n.js - å¤šåœ‹èªè¨€æ¨¡çµ„ï¼ˆæ”¯æ´ä½ç½®åƒæ•¸ï¼‰
(function (global) {
  const i18n = {
    data: {},
    currentLang: localStorage.getItem("lang") || "zh",
    ready: false,
      listeners: [], // â­ åŠ é€™è¡Œ
    async init(lang) {
      await this.load(lang || this.currentLang);
    },
      onChange(callback) {
          this.listeners.push(callback);
      },
      _emitChange() {
          this.listeners.forEach(fn => fn(this.currentLang));
      },
    async load(lang) {
      const url = `lang/${lang}.json`;
      try {
        const response = await fetch(url);
        if (!response.ok) throw new Error(`èªè¨€åŒ…è¼‰å…¥å¤±æ•—: ${url}`);
        this.data = await response.json();
        this.currentLang = lang;
        localStorage.setItem("lang", lang);
          this.ready = true;
          this._emitChange(); // â­ èªè¨€åˆ‡æ›å¾Œé€šçŸ¥æ‰€æœ‰ listener
      } catch (err) {
        console.error("âŒ i18n è¼‰å…¥éŒ¯èª¤:", err);
      }
    },

    /**
     * å–å¾—ç¿»è­¯æ–‡å­—ï¼Œæ”¯æ´å¤šå±¤ keyï¼ˆa.b.cï¼‰
     * ä¸¦æ”¯æ´ä½ç½®åƒæ•¸ {0}, {1}, ...
     * i18n.t("welcome", "ç‹å°æ˜") â†’ "ä½ å¥½ï¼Œç‹å°æ˜ï¼"
     */
      t(key, ...args) {
          if (args.length === 1 && Array.isArray(args[0])) {
              args = args[0];
          }

      const keys = key.split(".");
      let val = this.data;
      for (const k of keys) {
        val = val?.[k];
        if (val === undefined) break;
      }
      if (val === undefined || val === null) return key;

      // å¦‚æœæ˜¯å­—ä¸²ä¸”æœ‰ä½ç½®åƒæ•¸
      if (typeof val === "string" && args.length > 0) {
        val = val.replace(/\{(\d+)\}/g, (match, index) => {
          return args[index] !== undefined ? args[index] : match;
        });
      }
      return val;
    },

   

    apply(target) {
      if (!this.ready) return;
      const $target = $(target || document);
      $target.find("[data-i18n]").each((_, el) => {
        const $el = $(el);
        const key = $el.attr("data-i18n");
        const argsAttr = $el.attr("data-i18n-args"); // å¯é¸ï¼Œé€—è™Ÿåˆ†éš”
        let args = [];
        if (argsAttr) {
          args = argsAttr.split(",").map(s => s.trim());
        }
        const value = this.t(key, ...args);
        if (el.textContent.trim() !== value) {
            if ($(el).is("input,button")) {
                $(el).val(value).text(value);
            } else {
                $(el).html(value); 
            //  alert($(el).innerHTML)
            }
        }
         

          // ğŸ”¹ Tooltip ç¿»è­¯ï¼ˆAdminLTE å°ˆç”¨ï¼‰
          $target.find("[data-i18n-tooltip]").each((_, el) => {
              const $el = $(el);
              const key = el.getAttribute("data-i18n-tooltip");
              if (!key) return;

              const tooltipText = this.t(key);

              // è¨­å®š title
              el.setAttribute("title", tooltipText);

              // tooltip éœ€è¦é‡æ–°åˆå§‹åŒ– 
              if ($el.data("tooltip")) {
                  $el.tooltip("destroy");
              }
              if (el.getAttribute("data-toggle") === "tooltip") {
                  $el.tooltip({
                      container: "body",
                      placement: "right",
                      trigger: "hover"
                  });
              }
          });

      });
    },
      translateText(text) {
          // æ‰¾ menuItems å°æ‡‰
          const map = this.data?.menuItems || {};
          return map[text.trim()] || text;
      },
    async setLang(lang) {
      await this.load(lang);
      this.apply(document);
    },

    getLang() {
      return this.currentLang;
    }
  };

  global.i18n = i18n;
})(window);


<!-- â‘  jQueryï¼ˆä¸€å®šè¦åœ¨å‰ï¼‰ -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="../../Scripts/tb.js"></script>
<!-- â‘¡ DataTables 2.3.5 -->
<link rel="stylesheet"
      href="https://cdn.datatables.net/2.3.5/css/dataTables.dataTables.min.css">
<script src="https://cdn.datatables.net/2.3.5/js/dataTables.min.js"></script>
<style>
    .dt-scroll-body thead {
        visibility: hidden;
    }
    </style>
<table id="demo"></table>

<script>
    const rows = [
        { id: 1, name: 'Tom', age: 18 },
        { id: 2, name: 'Mary', age: 25 }
    ];
    const schema = [
        { field: 'id', title: 'ID' },
        { field: 'name', title: 'Name cc' },
        { field: 'age', title: 'Age' }
    ];
    const columns = schema.map(c => ({
        title: c.title, // åŠ ä¸Š title é¿å…ç©ºç™½ row
        data: c.field
    }));
    const table = DtI18n.create('#demo', {
        scrollY: 200,
        data: rows,
        columns
    });

    //function refreshLengthMenuText(dt) {
    //    const wrapper = dt.table().container();
    //    const label = wrapper.querySelector('.dt-length label');
    //    if (!label) return;

    //    const select = label.querySelector('select');
    //    label.innerHTML = '';
    //    label.append(
    //        parent.i18n.t('dt.lengthMenu').replace('_MENU_', ''),
    //        select
    //    );
    //}
    //function patchDtEmptyText(dt, i18n) {
    //    const container = dt.table().container();

    //    // emptyTable & zeroRecords éƒ½æ˜¯é€™å€‹ td
    //    const emptyCell = container.querySelector('td.dt-empty');

    //    if (!emptyCell) return;

    //    const isFiltered = dt.search() && dt.search().length > 0;

    //    emptyCell.innerHTML = isFiltered
    //        ? i18n.t('dt.zeroRecords')
    //        : i18n.t('dt.emptyTable');
    //}
    //const schema = [
    //    { field: 'id', title: 'ID' },
    //    { field: 'name', title: 'Name cc' },
    //    { field: 'age', title: 'Age' }
    //];

    //let theadHtml = '<thead><tr>';

    //schema.forEach(c => {
    //    let t1= c.title.toLowerCase();
    //    theadHtml += `<th data-field="${c.field}" data-i18n="${c.title.toLowerCase() || ''}">${c.title}</th>`;
    //});

    //theadHtml += '</tr></thead>';

    //const tableEl = document.getElementById('demo');
    //tableEl.insertAdjacentHTML('afterbegin', theadHtml);
    //const rows = [
    //    { id: 1, name: 'Tom', age: 18 },
    //    { id: 2, name: 'Mary', age: 25 }
    //];


    //const columns = schema.map(c => ({
    //    title: c.title, // åŠ ä¸Š title é¿å…ç©ºç™½ row
    //    data: c.field
    //}));
    ////document.querySelectorAll('.dt-column-header').forEach(el => el.remove());

    //const table = new DataTable('#demo', {
    //    scrollY: 200,
    //    data: rows,
    //    columns,
    //    language: {
    //        lengthMenu: parent.i18n.t("dt.lengthMenu"),
    //        emptyTable: parent.i18n.t("dt.emptyTable"),
    //        zeroRecords: parent.i18n.t("dt.zeroRecords"),
    //    },
    //    infoCallback: function (settings, start, end, max, total) {
    //        if (total === 0) {
    //            return parent.i18n.t("dt.infoEmpty");
    //        }
    //        return parent.i18n.t("dt.info", [start, end, total]);
    //    }
    //});

    //setTimeout(() => table.columns.adjust(), 100);

    //tableEl._dataTableInstance = table;

    //tableEl.setAttribute('data-dt-schema', null);
    if (parent.i18n && typeof parent.i18n.onChange === 'function') {
        parent.i18n.onChange(lang => {
           
            //refreshLengthMenuText(table);
            //patchDtEmptyText(table, parent.i18n);
            table.draw(false);   // â­ è§¸ç™¼ infoCallback
            // èª¿æ•´æ¬„å¯¬
            //table.columns.adjust();
        });
    }

    // ç¶å®š i18n è®ŠåŒ–ç›£è½
    //window.parent.i18n.onChange(lang => {
    //    updateDataTableLang(table, schema, lang);
    //});


    //function updateDataTableLang(table, schema, lang) {
    //    // æ›´æ–° i18n è³‡æ–™
    //    //window.parent.i18n.load(lang).then(() => {
    //        // æ›´æ–° <thead> æ–‡å­—
    //        //$('#demo thead th').each((idx, th) => {
    //        //    $(th).text(window.parent.i18n.t(schema[idx].title.toLowerCase()));
    //        //});
    //        //Array.from(table.columns().header).forEach((th, idx) => {
    //        //    th.textContent = i18n.t(schema[idx].title.toLowerCase());
    //        //});
    //        // æ›´æ–° DataTable header
    //        //table.columns().header().forEach((th, idx) => {
    //        //    $(th).text(window.parent.i18n.t(schema[idx].title.toLowerCase()));
    //        //});

    //        // èª¿æ•´æ¬„å¯¬ï¼Œé¿å… scrollBody ç©ºç™½ row
    //        table.columns.adjust();
    //    //});
    //}

</script>





